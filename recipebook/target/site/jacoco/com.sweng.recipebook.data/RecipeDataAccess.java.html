<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RecipeDataAccess.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">recipebook</a> &gt; <a href="index.source.html" class="el_package">com.sweng.recipebook.data</a> &gt; <span class="el_source">RecipeDataAccess.java</span></div><h1>RecipeDataAccess.java</h1><pre class="source lang-java linenums">package com.sweng.recipebook.data;

import java.sql.Blob;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import com.sweng.recipebook.models.IngredientComposite;
import com.sweng.recipebook.models.Recipe;
import com.sweng.recipebook.models.RecipeMediaComposite;
import com.sweng.recipebook.models.SharedRecipe;

/**
 * RecipeDataAccess - DataAccess class for application recipes.
 */
public class RecipeDataAccess extends DataAccess {

    public RecipeDataAccess() {
<span class="fc" id="L21">        super();</span>
<span class="fc" id="L22">    }</span>

    /**
     * addRecipe - Method to add a recipe to the recipes table.
     * 
     * @param recipe - Recipe to be added.
     * @param userId - User id adding the recipe.
     * @return - Added recipe id int.
     * @throws SQLException // this.correctJSONCharacters(
     */
    public int addRecipe(Recipe recipe, int userId) throws SQLException {
<span class="fc" id="L33">        String dml = &quot;INSERT INTO recipebook_recipes (recipe_name, recipe_description, serving_size, instructions, user_id) VALUES (?, ?, ?, ?, ?)&quot;;</span>
<span class="fc" id="L34">        PreparedStatement statement = connection.prepareStatement(dml);</span>
<span class="fc" id="L35">        Blob blob = connection.createBlob();</span>
        try {
<span class="fc" id="L37">            blob.setBytes(1, this.correctJSONCharacters(recipe.getInstructions()).getBytes());</span>
<span class="fc" id="L38">            statement.setString(1, this.correctJSONCharacters(recipe.getRecipeName()));</span>
<span class="fc" id="L39">            statement.setString(2, this.correctJSONCharacters(recipe.getRecipeDescription()));</span>
<span class="fc" id="L40">            statement.setInt(3, recipe.getServingSize());</span>
<span class="fc" id="L41">            statement.setBlob(4, blob);</span>
<span class="fc" id="L42">            statement.setInt(5, userId);</span>
<span class="fc" id="L43">            statement.execute();</span>
<span class="fc" id="L44">        } finally {</span>
<span class="fc" id="L45">            statement.close();</span>
        }
<span class="fc" id="L47">        return getRecipeId(recipe.getRecipeName(), userId);</span>
    }

    /**
     * getHomeRecipes - Method to retrieve recipes for showcasing on the home page.
     * 
     * @return - List of Recipes.
     * @throws SQLException
     */
    public List&lt;Recipe&gt; getHomeRecipes() throws SQLException {
<span class="fc" id="L57">        List&lt;Recipe&gt; result = new ArrayList&lt;Recipe&gt;();</span>
<span class="fc" id="L58">        String query = &quot;SELECT recipe_id, recipe_name, recipe_description FROM recipebook_recipes ORDER BY recipe_id&quot;;</span>
<span class="fc" id="L59">        PreparedStatement statement = connection.prepareStatement(query);</span>
        try {
<span class="fc" id="L61">            ResultSet resultSet = statement.executeQuery();</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">            while (resultSet.next()) {</span>
<span class="fc" id="L63">                result.add(new SharedRecipe(resultSet.getInt(&quot;recipe_id&quot;), resultSet.getString(&quot;recipe_name&quot;),</span>
<span class="fc" id="L64">                        resultSet.getString(&quot;recipe_description&quot;), 0, &quot;&quot;, new IngredientComposite()));</span>
            }
<span class="fc" id="L66">        } finally {</span>
<span class="fc" id="L67">            statement.close();</span>
        }
<span class="fc" id="L69">        return result;</span>
    }

    /**
     * getRecipe - Method to retrieve a recipe for a given id number.
     * 
     * @param recipeId             - Recipe id number.
     * @param ingredientComposite  - Recipe ingredients.
     * @param recipeMediaComposite - Recipe media.
     * @return - Recipe for the given id number.
     * @throws SQLException
     */
    public Recipe getRecipe(int recipeId, IngredientComposite ingredientComposite,
            RecipeMediaComposite recipeMediaComposite) throws SQLException {
<span class="fc" id="L83">        Recipe result = new SharedRecipe();</span>
<span class="fc" id="L84">        String query = &quot;SELECT recipe_id, recipe_name, recipe_description, serving_size, instructions, user_id AS shared_by_id, first_name || ' ' || SUBSTR(last_name, 1, 1) || '.' AS shared_by_name FROM recipebook_recipes JOIN recipebook_user USING (user_id) WHERE recipe_id = ?&quot;;</span>
<span class="fc" id="L85">        PreparedStatement statement = connection.prepareStatement(query);</span>
        try {
<span class="fc" id="L87">            statement.setInt(1, recipeId);</span>
<span class="fc" id="L88">            ResultSet resultSet = statement.executeQuery();</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">            while (resultSet.next()) {</span>
<span class="fc" id="L90">                result = new SharedRecipe(resultSet.getInt(&quot;recipe_id&quot;), resultSet.getString(&quot;recipe_name&quot;),</span>
<span class="fc" id="L91">                        resultSet.getString(&quot;recipe_description&quot;), resultSet.getInt(&quot;serving_size&quot;),</span>
<span class="fc" id="L92">                        new String(resultSet.getBytes(&quot;instructions&quot;)), ingredientComposite, recipeMediaComposite,</span>
<span class="fc" id="L93">                        resultSet.getString(&quot;shared_by_name&quot;), resultSet.getInt(&quot;shared_by_id&quot;));</span>
            }
<span class="fc" id="L95">        } finally {</span>
<span class="fc" id="L96">            statement.close();</span>
        }
<span class="fc" id="L98">        return result;</span>
    }

    /**
     * getRecipeId - Method to retrieve the recipe id for the given recipe and user
     * id.
     * 
     * @param recipeName - Shared recipe.
     * @param userId     - User id of shared recipe.
     * @return - Recipe id int.
     * @throws SQLException
     */
    public int getRecipeId(String recipeName, int userId) throws SQLException {
<span class="fc" id="L111">        int result = 0;</span>
<span class="fc" id="L112">        String query = &quot;SELECT recipe_id FROM recipebook_recipes WHERE user_id = ? AND recipe_name = ?&quot;;</span>
<span class="fc" id="L113">        PreparedStatement statement = connection.prepareStatement(query);</span>
        try {
<span class="fc" id="L115">            statement.setInt(1, userId);</span>
<span class="fc" id="L116">            statement.setString(2, this.correctJSONCharacters(recipeName));</span>
<span class="fc" id="L117">            ResultSet resultSet = statement.executeQuery();</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">            while (resultSet.next()) {</span>
<span class="fc" id="L119">                result = resultSet.getInt(&quot;recipe_id&quot;);</span>
            }
<span class="fc" id="L121">        } finally {</span>
<span class="fc" id="L122">            statement.close();</span>
        }
<span class="fc" id="L124">        return result;</span>
    }

    /**
     * removeRecipe - Method to remove a user from the application user table.
     * 
     * @param userId - Recipe id number to be removed.
     * @throws SQLException
     */
    public void removeRecipe(int recipeId) throws SQLException {
<span class="fc" id="L134">        String dml = &quot;DELETE FROM recipebook_recipes WHERE recipe_id = ?&quot;;</span>
<span class="fc" id="L135">        PreparedStatement statement = connection.prepareStatement(dml);</span>
        try {
<span class="fc" id="L137">            statement.setInt(1, recipeId);</span>
<span class="fc" id="L138">            statement.executeUpdate();</span>
<span class="fc" id="L139">        } finally {</span>
<span class="fc" id="L140">            statement.close();</span>
        }
<span class="fc" id="L142">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.4.201905082037</span></div></body></html>